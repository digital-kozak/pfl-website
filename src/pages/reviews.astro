---
import Layout from '../layouts/Layout.astro';
import reviewsData from '../data/reviews.json';

const { totalReviews, reviewsPerPage, totalPages, reviews } = reviewsData;

// Calculate stats from actual data
const avgRating = (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(2);

const stats = [
  { value: avgRating, label: "Average Rating" },
  { value: totalReviews.toString(), label: "Reviews" },
  { value: "100%", label: "Would Recommend" }
];
---

<Layout 
  title="Reviews | Pagosa Forest Lodge" 
  description={`Read ${totalReviews}+ guest reviews of Pagosa Forest Lodge. ${avgRating}-star average rating for our luxury mountain cabin near Wolf Creek Ski Resort in Colorado.`}
  breadcrumbs={[{ name: "Reviews", url: "/reviews" }]}
>
  <script>
    // Client-side pagination
    document.addEventListener('DOMContentLoaded', function() {
      const reviewsPerPage = 12;
      const reviewCards = document.querySelectorAll('.review-card');
      const totalPages = Math.ceil(reviewCards.length / reviewsPerPage);
      const paginationContainer = document.getElementById('pagination');
      const prevBtn = document.getElementById('prev-page');
      const nextBtn = document.getElementById('next-page');
      let currentPage = 1;

      function showPage(page) {
        // Hide all reviews
        reviewCards.forEach((card, index) => {
          const start = (page - 1) * reviewsPerPage;
          const end = start + reviewsPerPage;
          if (index >= start && index < end) {
            card.classList.remove('hidden');
          } else {
            card.classList.add('hidden');
          }
        });

        // Update pagination buttons
        if (prevBtn) prevBtn.disabled = page === 1;
        if (nextBtn) nextBtn.disabled = page === totalPages;

        // Update page numbers
        const pageButtons = document.querySelectorAll('.page-btn');
        pageButtons.forEach(btn => {
          const btnPage = parseInt(btn.dataset.page);
          if (btnPage === page) {
            btn.classList.add('bg-[#0f1f0a]', 'text-white');
            btn.classList.remove('bg-white', 'text-[#0f1f0a]');
          } else {
            btn.classList.remove('bg-[#0f1f0a]', 'text-white');
            btn.classList.add('bg-white', 'text-[#0f1f0a]');
          }
        });

        // Update showing text
        const showingText = document.getElementById('showing-text');
        if (showingText) {
          const start = (page - 1) * reviewsPerPage + 1;
          const end = Math.min(page * reviewsPerPage, reviewCards.length);
          showingText.textContent = `Showing ${start}-${end} of ${reviewCards.length} reviews`;
        }

        currentPage = page;
      }

      // Create pagination buttons
      if (paginationContainer && totalPages > 1) {
        let paginationHTML = '';
        
        for (let i = 1; i <= totalPages; i++) {
          paginationHTML += `
            <button 
              class="page-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i === 1 ? 'bg-[#0f1f0a] text-white' : 'bg-white text-[#0f1f0a] hover:bg-[#0f1f0a]/10'} border border-gray-200"
              data-page="${i}"
            >
              ${i}
            </button>
          `;
        }
        
        paginationContainer.innerHTML = paginationHTML;

        // Add click handlers
        document.querySelectorAll('.page-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            showPage(parseInt(btn.dataset.page));
          });
        });
      }

      // Previous/Next buttons
      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          if (currentPage > 1) showPage(currentPage - 1);
        });
      }

      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          if (currentPage < totalPages) showPage(currentPage + 1);
        });
      }

      // Show first page
      showPage(1);
    });
  </script>

  <!-- Hero -->
  <section class="relative py-32 hero-overlay">
    <div class="absolute inset-0 z-0">
      <img 
        src="/images/reviews-hero.jpg" 
        alt="Mountain valley view from Wolf Creek Pass" 
        class="w-full h-full object-cover"
      />
    </div>
    
    <div class="relative z-10 container-custom text-center text-white">
      <p class="text-sm uppercase tracking-[0.3em] mb-4">Guest Experiences</p>
      <h1 class="font-serif text-5xl md:text-7xl">
        <span class="italic">Reviews</span>
      </h1>
    </div>
  </section>

  <!-- Stats -->
  <section class="py-16 bg-white">
    <div class="container-custom">
      <!-- Badges -->
      <div class="flex flex-wrap justify-center gap-6 mb-12">
        <!-- Guest Favorite Badge -->
        <div class="flex items-center justify-center">
          <img 
            src="/images/airbnb-guest-favorite.jpg" 
            alt="Airbnb Guest Favorite - One of the most loved homes on Airbnb" 
            class="h-28 md:h-32 object-contain rounded-lg shadow-md"
          />
        </div>
        
        <!-- Superhost Badge -->
        <div class="flex items-center justify-center">
          <img 
            src="/images/airbnb-superhost.jpg" 
            alt="Airbnb Superhost" 
            class="h-28 md:h-32 object-contain rounded-lg shadow-md"
          />
        </div>
      </div>
      
      <!-- Stats Grid -->
      <div class="grid grid-cols-3 gap-8 text-center max-w-3xl mx-auto pt-8 border-t border-gray-200">
        {stats.map((stat) => (
          <div>
            <p class="text-4xl md:text-5xl font-serif text-[#c9a227] mb-2">{stat.value}</p>
            <p class="text-sm uppercase tracking-wider text-gray-600">{stat.label}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Reviews Grid -->
  <section class="section-padding bg-[#faf9f6]">
    <div class="container-custom">
      <div class="text-center max-w-3xl mx-auto mb-12">
        <p class="text-[#c9a227] text-sm uppercase tracking-[0.2em] mb-4">Testimonials</p>
        <h2 class="font-serif text-4xl md:text-5xl text-[#0f1f0a]">What Guests <span class="italic">Are Saying</span></h2>
        <p id="showing-text" class="text-gray-500 mt-4">Showing 1-{Math.min(reviewsPerPage, totalReviews)} of {totalReviews} reviews</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
        {reviews.map((review) => (
          <div class="review-card bg-white p-8 rounded-lg shadow-sm">
            <!-- Stars -->
            <div class="flex text-[#c9a227] mb-4">
              {[...Array(5)].map((_, i) => (
                <svg class={`w-5 h-5 ${i < review.rating ? '' : 'text-gray-300'}`} fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              ))}
            </div>
            
            <!-- Review Text -->
            <p class="text-gray-700 mb-6 leading-relaxed italic">"{review.text}"</p>
            
            <!-- Author -->
            <div class="flex items-center">
              <div class="w-12 h-12 rounded-full bg-[#c9a227]/10 flex items-center justify-center mr-4">
                <span class="text-[#c9a227] font-serif text-lg">{review.avatar}</span>
              </div>
              <div>
                <p class="font-medium text-[#0f1f0a]">{review.name}</p>
                <p class="text-sm text-gray-500">{review.location} • {review.date}</p>
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- Pagination -->
      {totalPages > 1 && (
        <div class="flex justify-center items-center space-x-2">
          <button 
            id="prev-page"
            class="px-4 py-2 rounded-lg text-sm font-medium bg-white text-[#0f1f0a] border border-gray-200 hover:bg-[#0f1f0a]/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            disabled
          >
            ← Previous
          </button>
          
          <div id="pagination" class="flex space-x-2">
            <!-- Page numbers will be inserted here by JavaScript -->
          </div>
          
          <button 
            id="next-page"
            class="px-4 py-2 rounded-lg text-sm font-medium bg-white text-[#0f1f0a] border border-gray-200 hover:bg-[#0f1f0a]/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          >
            Next →
          </button>
        </div>
      )}
    </div>
  </section>

  <!-- CTA Section -->
  <section class="section-padding bg-[#0f1f0a] text-white">
    <div class="container-custom text-center">
      <p class="text-[#c9a227] text-sm uppercase tracking-[0.3em] mb-4">Ready to Experience It?</p>
      <h2 class="font-serif text-4xl md:text-5xl mb-6">Join Our <span class="italic">Happy Guests</span></h2>
      <p class="text-white/70 max-w-2xl mx-auto mb-8 text-lg">
        Book your stay today and see why {totalReviews}+ guests have given us a {avgRating}-star rating.
      </p>
      <a href="/book" class="btn-primary text-lg">Book Your Stay</a>
    </div>
  </section>
</Layout>
